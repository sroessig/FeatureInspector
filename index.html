<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
</head>
<body>

    <h2>Features</h2>

    <button type="button" class="btn btn-secondary first" value="t">t</button>
    <button type="button" class="btn btn-secondary first" value="h">h</button>

    <br>
    <hr>

    <button type="button" class="btn btn-secondary second" value="tʼ">tʼ</button>
    <br>
    <hr>

    <div id="result"></div>
    <br>
    <hr>

    <button type="button" class="btn btn-dark" id="new">New comparison</button>
<script>

    let symbol1 = ""
    let symbol2 = ""

$(".first").on( "click", function() {
    symbol1 = $(this).val()
    $(this).removeClass("btn-secondary").addClass("btn-primary")
})

$(".second").on( "click", function() {
    symbol2 = $(this).val()
    compare(symbol1, symbol2)
    $(this).removeClass("btn-secondary").addClass("btn-primary")
})

$("#new").on( "click", function() {
    $(".first").removeClass("btn-primary").addClass("btn-secondary")
    $(".second").removeClass("btn-primary").addClass("btn-secondary")
    $("#result").html("")
})

$.getJSON('http://localhost:8000/data.json', function(data) {
    sounds = data
});


// Define data.
// TODO: The (much longer) json needs to be loaded from server
/* let sounds_raw = '{' +
'"t": {' +
    '"name": "voiceless alveolar stop",' +
        '"features": {' +
        '"cons": true,' +
            '"son": false,' +
            '"syl": false,' +
            '"labial": false,' +
            '"round": 0,' +
            '"coronal": true,' +
            '"ant": true,' +
            '"dist": false,' +
            '"dorsal": true,' +
            '"high": 0,' +
            '"low": 0,' +
            '"back": 0,' +
            '"tense": 0,' +
            '"pharyngeal": false,' +
            '"ATR": 0,' +
            '"voice": false,' +
            '"SG": false,' +
            '"CG": false,' +
            '"cont": false,' +
            '"strident": false,' +
            '"lateral": false,' +
            '"del_rel": false,' +
            '"nasal": false' +
            '}' +
        '},' +
    '"tʼ": {' +
    '"name": "ejective voiceless alveolar stop",' +
        '"features": {' +
        '"cons": true,' +
            '"son": false,' +
            '"syl": false,' +
            '"labial": false,' +
            '"round": 0,' +
            '"coronal": true,' +
            '"ant": true,' +
            '"dist": false,' +
            '"dorsal": true,' +
            '"high": 0,' +
            '"low": 0,' +
            '"back": 0,' +
            '"tense": 0,' +
            '"pharyngeal": false,' +
            '"ATR": 0,' +
            '"voice": false,' +
            '"SG": false,' +
            '"CG": true,' +
            '"cont": false,' +
            '"strident": false,' +
            '"lateral": false,' +
            '"del_rel": false,' +
            '"nasal": false' +
            '}' +
        '}' +
    '}' */


    // Compare to sounds
    function compare(symbol1, symbol2) {
    
        let sound1 = sounds[symbol1]
        let sound2 = sounds[symbol2]

        let feature_bndl1 = sound1.features
        let feature_bndl2 = sound2.features
        
        let feature_list = Object.keys(feature_bndl1)
        let n_features = feature_list.length

        for (let i = 0; i < n_features; i++) {

            // TODO: more transparent syntax needed here
            if (feature_bndl1[feature_list[i]].toString() != feature_bndl2[feature_list[i]].toString()) {
                $("#result").append("<br>" + symbol1 + ": [" + minus_plus_zero(feature_bndl1[feature_list[i]].toString()) + feature_list[i] + "]")
                $("#result").append("<br>" + symbol2 + ": [" + minus_plus_zero(feature_bndl2[feature_list[i]].toString()) + feature_list[i] + "]")
            }
        }


        function minus_plus_zero(value) {
            if(value == "0") return "0"
            else if(value == "true") return "+"
            else if(value == "false") return "-"
        }
    
    }






</script>

</body>
</html>