<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
</head>

<body>
    <div class="container">

        <div class="row">
            <div class="col-sm">

                <h2>Features</h2>

                <button type="button" class="btn btn-dark" id="new">New comparison</button>

                <br>
                <hr>
            </div>
        </div>

        <div class="row">
            <div class="col-9" id="keyboard">
            </div>
            <div class="col-sm" id="result1">
            </div>
            <div class="col-sm" id="result2">
            </div>

        </div>

        <script>


            // Get data
            $.getJSON('http://localhost:8000/data.json', function (data) {
                sounds = data


            }).then(function (data) {

                // Populate UI:
                // Find all different manner groups (plosives, nasals, fricatives, ...)
                // and make one heading and div for them
                let n_sounds = Object.keys(sounds).length
                let distinct_sounds = Object.keys(sounds)
                let manner_groups = []
                for (let i = 0; i < n_sounds; i++) {

                    let this_sound = distinct_sounds[i]
                    let manner_group = sounds[this_sound].manner_group

                    // If there hasn't been a sound of this manner group
                    // Create new div and heading
                    if (!manner_groups.includes(manner_group)) {
                        manner_groups.push(manner_group)
                        $("#keyboard").append("<div id=" + manner_group + "><br><h5>" + manner_group + "</h5></div>")
                    }

                    $("#" + manner_group).append('<button type="button" class="btn btn-secondary sounds" value="' + this_sound + '">' + this_sound + '</button> ')

                }

                let symbol1 = ""
                let symbol2 = ""

                let sounds_picked = 0

                // Functionality of sounds "keyboard"
                $(".sounds").on("click", function () {

                    console.log("bla")

                    if (sounds_picked == 0) {
                        symbol1 = $(this).val()
                        $(this).removeClass("btn-secondary").addClass("btn-primary")
                        $(this).prop("disabled", true)
                    }

                    else if (sounds_picked == 1) {
                        symbol2 = $(this).val()
                        $(this).removeClass("btn-secondary").addClass("btn-primary")
                        $(this).prop("disabled", true)
                        compare(symbol1, symbol2)
                    }
                    sounds_picked += 1
                })

                // Functionality of "new comparison" button
                $("#new").on("click", function () {
                    $(".sounds").removeClass("btn-primary").addClass("btn-secondary").prop("disabled", false)
                    $("#result1").html("")
                    $("#result2").html("")
                    sounds_picked = 0
                })

            })

            // Compare to sounds
            function compare(symbol1, symbol2) {

                let sound1 = sounds[symbol1]
                let sound2 = sounds[symbol2]

                let feature_bndl1 = sound1.features
                let feature_bndl2 = sound2.features

                let feature_list = Object.keys(feature_bndl1)
                let n_features = feature_list.length

                $("#result1").append("<b>[" + symbol1 + "]</b>")
                $("#result2").append("<b>[" + symbol2 + "]</b>")

                for (let i = 0; i < n_features; i++) {

                    feat_value1 = feature_bndl1[feature_list[i]].toString()
                    feat_value2 = feature_bndl2[feature_list[i]].toString()
                    feature = feature_list[i]

                    if (feat_value1 != feat_value2) {
                        $("#result1").append("<br>" + "[" + minus_plus_zero(feat_value1) + feature + "]")
                        $("#result2").append("<br>" + "[" + minus_plus_zero(feat_value2) + feature + "]")
                    }
                }
            }


            function minus_plus_zero(value) {
                if (value == "0") return "0"
                else if (value == "true") return "+"
                else if (value == "false") return "-"
            }


        </script>

</body>

</html>