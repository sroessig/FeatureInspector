<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
</head>

<body>
    <div class="container">

        <div class="row">
            <div class="col-sm">
           
                <h2>Features</h2>

                <button type="button" class="btn btn-dark" id="new">New comparison</button>

                <br>
                <hr>
            </div>
        </div>

        <div class="row">
            <div class="col-sm">

                <h5>Stops</h5>

                <button type="button" class="btn btn-secondary sounds" value="t">t</button>
                <button type="button" class="btn btn-secondary sounds" value="d">d</button>
                <br><br>

                <h5>Nasals</h5>
                <button type="button" class="btn btn-secondary sounds" value="m">m</button>
                <button type="button" class="btn btn-secondary sounds" value="n">n</button>
                <button type="button" class="btn btn-secondary sounds" value="ŋ">ŋ</button>
                <button type="button" class="btn btn-secondary sounds" value="ɲ">ɲ</button>
                <button type="button" class="btn btn-secondary sounds" value="ɴ">ɴ</button>

            </div>
            <div class="col-sm">
                <div id="result"></div>
            </div>

        </div>

        <script>

            let symbol1 = ""
            let symbol2 = ""

            let sounds_picked = 0

            $(".sounds").on("click", function () {

                if (sounds_picked == 0) {
                    symbol1 = $(this).val()
                    $(this).removeClass("btn-secondary").addClass("btn-primary")
                }

                else if (sounds_picked == 1) {
                    symbol2 = $(this).val()
                    $(this).removeClass("btn-secondary").addClass("btn-primary")
                    compare(symbol1, symbol2)
                }
                sounds_picked += 1
            })

            $("#new").on("click", function () {
                $(".sounds").removeClass("btn-primary").addClass("btn-secondary")
                $("#result").html("")
                sounds_picked = 0
            })

            $.getJSON('http://localhost:8000/data.json', function (data) {
                sounds = data
            });

            // Compare to sounds
            function compare(symbol1, symbol2) {

                let sound1 = sounds[symbol1]
                let sound2 = sounds[symbol2]

                let feature_bndl1 = sound1.features
                let feature_bndl2 = sound2.features

                let feature_list = Object.keys(feature_bndl1)
                let n_features = feature_list.length

                for (let i = 0; i < n_features; i++) {

                    // TODO: more transparent syntax needed here
                    if (feature_bndl1[feature_list[i]].toString() != feature_bndl2[feature_list[i]].toString()) {
                        $("#result").append("<br>" + symbol1 + ": [" + minus_plus_zero(feature_bndl1[feature_list[i]].toString()) + feature_list[i] + "]")
                        $("#result").append("<br>" + symbol2 + ": [" + minus_plus_zero(feature_bndl2[feature_list[i]].toString()) + feature_list[i] + "]")
                    }
                }


                function minus_plus_zero(value) {
                    if (value == "0") return "0"
                    else if (value == "true") return "+"
                    else if (value == "false") return "-"
                }

            }


        </script>

</body>

</html>